# wtmux: Windows向けtmuxライクなターミナルマルチプレクサ

## はじめに

Linuxやmacでターミナル作業をする人にとって、**tmux**は欠かせないツールです。複数のターミナルセッションを1つの画面で管理し、ペイン分割やセッションの保存ができる便利なツールですが、残念ながらWindowsではネイティブに動作しません。

**wtmux**は、そんなtmuxの使い勝手をWindowsで実現するために開発されたターミナルマルチプレクサです。Rustで書かれており、Windows 10以降のConPTY（Console Pseudo Terminal）を活用して、ネイティブなWindows体験を提供します。

### wtmuxの特徴

- **tmux互換のキーバインド** - tmuxユーザーならすぐに使える
- **複数タブ・ペイン分割** - 作業を効率的に整理
- **コピーモード** - vimライクな操作でスクロールバック
- **検索機能** - 出力履歴を素早く検索
- **コマンド履歴** - 入力したコマンドを記録・再利用
- **カラースキーム** - 8種類の組み込みテーマ
- **複数シェル対応** - cmd、PowerShell、PowerShell 7、WSL

---

## インストール

### 方法1: ポータブル版（推奨）

1. [Releases](https://github.com/user/wtmux/releases)ページから`wtmux-x.x.x-portable-x64.zip`をダウンロード
2. 任意のフォルダに展開
3. `wtmux.exe`を実行

### 方法2: インストーラー

1. [Releases](https://github.com/user/wtmux/releases)ページから`wtmux-x.x.x-setup.exe`をダウンロード
2. インストーラーを実行
3. コマンドプロンプトまたはPowerShellで`wtmux`を実行

### 方法3: ソースからビルド

```powershell
git clone https://github.com/user/wtmux.git
cd wtmux
cargo build --release
.\target\release\wtmux.exe
```

---

## クイックスタート

### 起動

```powershell
# デフォルト（cmd.exe）で起動
wtmux

# PowerShell 7で起動
wtmux -7

# WSLで起動
wtmux -w

# UTF-8エンコーディングで起動
wtmux -u
```

### 基本概念

wtmuxには3つの階層があります：

```
wtmux
├── タブ（ウィンドウ）1
│   ├── ペイン 1
│   └── ペイン 2
├── タブ（ウィンドウ）2
│   └── ペイン 1
└── タブ（ウィンドウ）3
    ├── ペイン 1
    ├── ペイン 2
    └── ペイン 3
```

- **タブ（ウィンドウ）**: 画面下部のタブバーに表示される、独立した作業スペース
- **ペイン**: タブ内で分割された個々のターミナル領域

---

## 基本操作

### プレフィックスキー

wtmuxのすべてのコマンドは **`Ctrl+B`** から始まります（tmuxと同じ）。

例えば、新しいタブを作成するには：
1. `Ctrl+B` を押す（画面下部に `[PREFIX]` と表示される）
2. `c` を押す

### タブ操作

| キー | 動作 |
|------|------|
| `Ctrl+B, c` | 新しいタブを作成 |
| `Ctrl+B, n` | 次のタブに移動 |
| `Ctrl+B, p` | 前のタブに移動 |
| `Ctrl+B, 0-9` | 番号でタブを選択 |
| `Ctrl+B, ,` | タブの名前を変更 |
| `Ctrl+B, &` | 現在のタブを閉じる |
| `Ctrl+B, l` | 最後に使用したタブに切り替え |

### ペイン操作

| キー | 動作 |
|------|------|
| `Ctrl+B, "` | 水平分割（上下に分ける） |
| `Ctrl+B, %` | 垂直分割（左右に分ける） |
| `Ctrl+B, ←↑↓→` | 矢印方向のペインに移動 |
| `Ctrl+B, o` | 次のペインに移動 |
| `Ctrl+B, x` | 現在のペインを閉じる |
| `Ctrl+B, z` | ペインをズーム（全画面表示/解除） |

### ペインのリサイズ

| キー | 動作 |
|------|------|
| `Ctrl+B, Ctrl+←` | 左方向に拡大 |
| `Ctrl+B, Ctrl+→` | 右方向に拡大 |
| `Ctrl+B, Ctrl+↑` | 上方向に拡大 |
| `Ctrl+B, Ctrl+↓` | 下方向に拡大 |

---

## チュートリアル: 開発環境を構築する

実際の使用例として、Web開発の作業環境を構築してみましょう。

### ステップ1: wtmuxを起動

```powershell
wtmux -7 -u  # PowerShell 7 + UTF-8
```

### ステップ2: ペインを分割

1. `Ctrl+B, %` で垂直分割（左右）
2. 右ペインで `Ctrl+B, "` で水平分割（上下）

これで3ペインのレイアウトができました：

```
┌─────────────────────┬─────────────────────┐
│                     │                     │
│   エディタ用        │   サーバーログ      │
│                     │                     │
│                     ├─────────────────────┤
│                     │                     │
│                     │   Git/テスト        │
│                     │                     │
└─────────────────────┴─────────────────────┘
```

### ステップ3: 各ペインで作業

**左ペイン（エディタ）:**
```powershell
cd your-project
code .  # VS Codeを起動
```

**右上ペイン（サーバー）:**
```powershell
cd your-project
npm run dev  # 開発サーバー起動
```

**右下ペイン（Git/テスト）:**
```powershell
cd your-project
git status
```

### ステップ4: ペイン間の移動

- `Ctrl+B, ←` で左ペインへ
- `Ctrl+B, →` で右ペインへ
- `Ctrl+B, ↑` で上のペインへ
- `Ctrl+B, ↓` で下のペインへ

### ステップ5: ズーム機能を活用

サーバーログを詳しく見たい時：
1. サーバーペインにフォーカス
2. `Ctrl+B, z` でズーム（全画面表示）
3. 確認後、再度 `Ctrl+B, z` で元に戻す

---

## レイアウトプリセット

`Ctrl+B, Space` でレイアウトを切り替えられます。5種類のプリセットが用意されています：

### 1. even-horizontal（横均等）
```
┌────────┬────────┬────────┐
│        │        │        │
│   1    │   2    │   3    │
│        │        │        │
└────────┴────────┴────────┘
```

### 2. even-vertical（縦均等）
```
┌──────────────────────────┐
│            1             │
├──────────────────────────┤
│            2             │
├──────────────────────────┤
│            3             │
└──────────────────────────┘
```

### 3. main-horizontal（メイン横）
```
┌──────────────────────────┐
│            1             │
├────────┬────────┬────────┤
│   2    │   3    │   4    │
└────────┴────────┴────────┘
```

### 4. main-vertical（メイン縦）
```
┌────────────────┬─────────┐
│                │    2    │
│       1        ├─────────┤
│                │    3    │
│                ├─────────┤
│                │    4    │
└────────────────┴─────────┘
```

### 5. tiled（タイル）
```
┌────────────┬─────────────┐
│     1      │      2      │
├────────────┼─────────────┤
│     3      │      4      │
└────────────┴─────────────┘
```

---

## コピーモード

ターミナルの出力履歴をスクロールしたり、テキストをコピーしたりするための機能です。

### コピーモードに入る

| キー | 動作 |
|------|------|
| `Ctrl+B, [` | コピーモード開始 |
| `Ctrl+B, /` | 検索モードで開始 |

### コピーモードでの操作

**カーソル移動（vimライク）:**

| キー | 動作 |
|------|------|
| `h` / `←` | 左 |
| `j` / `↓` | 下 |
| `k` / `↑` | 上 |
| `l` / `→` | 右 |
| `0` | 行頭 |
| `$` | 行末 |
| `g` | バッファ先頭 |
| `G` | バッファ末尾 |

**ページスクロール:**

| キー | 動作 |
|------|------|
| `Ctrl+U` | 半ページ上 |
| `Ctrl+D` | 半ページ下 |
| `Ctrl+B` | 1ページ上 |
| `Ctrl+F` | 1ページ下 |
| `PageUp` | 1ページ上 |
| `PageDown` | 1ページ下 |

**選択とコピー:**

| キー | 動作 |
|------|------|
| `Space` / `v` | 選択開始/解除 |
| `Enter` / `y` | 選択範囲をコピーして終了 |

**検索:**

| キー | 動作 |
|------|------|
| `/` | 前方検索 |
| `?` | 後方検索 |
| `n` | 次のマッチ |
| `N` | 前のマッチ |

**終了:**

| キー | 動作 |
|------|------|
| `q` / `Esc` | コピーモード終了 |

### コピーモードの実践例

長いログから特定のエラーを探す場合：

1. `Ctrl+B, /` で検索モードに入る
2. `error` と入力して `Enter`
3. `n` で次のマッチへ移動
4. 見つけたら `Space` で選択開始
5. `j` や `l` で選択範囲を広げる
6. `Enter` でクリップボードにコピー

---

## カラースキームの変更

wtmuxには8種類のカラースキームが組み込まれています。

### ランタイムで変更

1. `Ctrl+B, t` でテーマセレクターを開く
2. `↑`/`↓` でテーマを選択
3. `Enter` で適用

### 利用可能なテーマ

| テーマ | 説明 |
|--------|------|
| `default` | デフォルト |
| `solarized` | Solarized Dark |
| `monokai` | Monokai Pro |
| `nord` | Nord |
| `dracula` | Dracula |
| `gruvbox` | Gruvbox Dark |
| `tokyo-night` | Tokyo Night |

### 設定ファイルで指定

`%LOCALAPPDATA%\wtmux\config.toml` を作成：

```toml
color_scheme = "tokyo-night"
```

---

## コマンド履歴機能

wtmuxには、シェルの履歴機能とは別に、独自のコマンド履歴機能が搭載されています。入力したコマンドを記録し、複雑なコマンドを何度も入力する必要がなくなります。

| キー | 動作 |
|------|------|
| `Ctrl+R` | 履歴検索表示 |

詳細は: https://qiita.com/spumoni/items/7d43ed7e579d99cfda3e

---

## 設定ファイル

wtmuxは `%LOCALAPPDATA%\wtmux\config.toml` から設定を読み込みます。

### 設定例

```toml
# シェルの指定
shell = "pwsh.exe"

# 文字コード（65001 = UTF-8, 932 = Shift-JIS）
codepage = 65001

# カラースキーム
color_scheme = "tokyo-night"

# タブバー
[tab_bar]
visible = true

# ステータスバー
[status_bar]
visible = true
show_time = true

# ペイン
[pane]
border_style = "single"  # single, double, rounded, none

# カーソル
[cursor]
shape = "block"  # block, underline, bar
blink = true
```

---

## Tips & Tricks

### 1. シェルからwtmuxを検出する

wtmux内で実行されているかをスクリプトで判定できます：

**PowerShell:**
```powershell
if ($env:WTMUX) {
    Write-Host "wtmux内で実行中"
}
```

**cmd.exe:**
```batch
if defined WTMUX echo wtmux内で実行中
```

**bash (WSL):**
```bash
[ -n "$WTMUX" ] && echo "wtmux内で実行中"
```

### 2. ペイン番号で素早く移動

多くのペインがある場合：

1. `Ctrl+B, q` でペイン番号を表示
2. 2秒以内に番号キー（0-9）を押す
3. そのペインにフォーカスが移動

### 3. ペインの入れ替え

| キー | 動作 |
|------|------|
| `Ctrl+B, {` | 前のペインと入れ替え |
| `Ctrl+B, }` | 次のペインと入れ替え |

### 4. プレフィックスキーをアプリケーションに送る

`Ctrl+B` を使うアプリケーション（例: Emacs）がある場合：

`Ctrl+B, b` で `Ctrl+B` をそのままアプリケーションに送信

### 5. 複数タブを使い分ける

作業ごとにタブを分けて名前を付けると便利です：

1. `Ctrl+B, c` で新しいタブ作成
2. `Ctrl+B, ,` で名前を変更（例: "frontend", "backend", "logs"）
3. `Ctrl+B, 0`〜`9` で素早く切り替え

---

## tmuxユーザーのための対応表

| tmux | wtmux | 備考 |
|------|-------|------|
| `Ctrl+B, c` | `Ctrl+B, c` | 新規ウィンドウ |
| `Ctrl+B, "` | `Ctrl+B, "` | 水平分割 |
| `Ctrl+B, %` | `Ctrl+B, %` | 垂直分割 |
| `Ctrl+B, x` | `Ctrl+B, x` | ペイン終了 |
| `Ctrl+B, z` | `Ctrl+B, z` | ズーム |
| `Ctrl+B, [` | `Ctrl+B, [` | コピーモード |
| `Ctrl+B, Space` | `Ctrl+B, Space` | レイアウト切替 |
| `Ctrl+B, d` | - | デタッチ（未実装） |
| `tmux attach` | - | アタッチ（未実装） |

---

## トラブルシューティング

### 日本語が文字化けする

UTF-8モードで起動してください：

```powershell
wtmux -u
```

または設定ファイルで：

```toml
codepage = 65001
```

### キーが反応しない

プレフィックスモード（`Ctrl+B`）に入っているか確認してください。画面下部に `[PREFIX]` と表示されます。

`Esc` キーでプレフィックスモードをキャンセルできます。

### 画面表示が乱れる

ターミナルのサイズを変更すると再描画されます。または、そのペインで `clear` コマンドを実行してください。

---

## まとめ

wtmuxを使えば、Windowsでもtmuxライクなターミナル作業が可能になります。

**今日から使える基本コマンド:**

| 操作 | キー |
|------|------|
| 新しいタブ | `Ctrl+B, c` |
| 垂直分割 | `Ctrl+B, %` |
| 水平分割 | `Ctrl+B, "` |
| ペイン移動 | `Ctrl+B, 矢印` |
| ペインズーム | `Ctrl+B, z` |
| コピーモード | `Ctrl+B, [` |
| 検索 | `Ctrl+B, /` |
| テーマ変更 | `Ctrl+B, t` |

ぜひ日々の開発作業に取り入れてみてください！

---

## リンク

- **GitHub**: https://github.com/user/wtmux
- **Releases**: https://github.com/user/wtmux/releases
- **Issue報告**: https://github.com/user/wtmux/issues
